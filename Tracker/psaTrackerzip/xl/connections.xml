<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<connections xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main"><connection id="1" name="PropQuery" type="1" refreshedVersion="6" savePassword="1" background="1" saveData="1"><dbPr connection="dsn=RPTSERVER;database=rptdb;server=RPTSQL.nsf.gov;port=5000;UID=ccfuser;PWD=CCfdata11/17;" command="set nocount on_x000d__x000a_SELECT isnull(prop.lead_prop_id,prop.prop_id) AS 'lead_id',_x000d__x000a_CASE WHEN prop.lead_prop_id IS NULL THEN 'I' WHEN prop.lead_prop_id = prop.prop_id THEN 'L' ELSE 'N' END AS ILN, prop.prop_id,_x000d__x000a_(SELECT MAX( CASE pa.prop_atr_seq WHEN 1 THEN pa.prop_atr_code ELSE '' END ) + ' ' +_x000d__x000a_        MAX( CASE pa.prop_atr_seq WHEN 2 THEN pa.prop_atr_code ELSE '' END ) + ' ' +_x000d__x000a_        MAX( CASE pa.prop_atr_seq WHEN 3 THEN pa.prop_atr_code ELSE '' END ) + ' ' +_x000d__x000a_        MAX( CASE pa.prop_atr_seq WHEN 4 THEN pa.prop_atr_code ELSE '' END ) + ' ' +_x000d__x000a_        MAX( CASE pa.prop_atr_seq WHEN 5 THEN pa.prop_atr_code ELSE '' END ) + ' ' +_x000d__x000a_        MAX( CASE pa.prop_atr_seq WHEN 6 THEN pa.prop_atr_code ELSE '' END )_x000d__x000a_        FROM csd.prop_atr pa  WHERE pa.prop_id = prop.prop_id  AND pa.prop_atr_type_code = 'PRC' ) AS 'PRCs',_x000d__x000a_(SELECT Count(*) FROM csd.rev_prop rp WHERE prop.prop_id=rp.prop_id AND rp.rev_type_code='R')  AS 'adhoc_reqd',_x000d__x000a_(SELECT Count(*) FROM csd.rev_prop rp WHERE prop.prop_id=rp.prop_id AND rp.rev_type_code='R' AND rp.rev_stts_code='P')  AS 'adhoc_pend',_x000d__x000a_(SELECT Max(rp.rev_due_date) FROM csd.rev_prop rp WHERE prop.prop_id=rp.prop_id AND rp.rev_type_code='R' AND rp.rev_stts_code='P')  AS 'last_adhoc_due',_x000d__x000a_(SELECT Count(*) FROM csd.rev_prop rp WHERE prop.prop_id=rp.prop_id AND rp.rev_stts_code='R')  AS 'revRcvd',_x000d__x000a_(SELECT Max(rp.rev_due_date) FROM csd.rev_prop rp WHERE prop.prop_id=rp.prop_id)  AS 'last_rev_due', prop.nsf_rcvd_date,nullif(prop.dd_rcom_date,'1/1/1900') AS dd_rcom_date_x000d__x000a_INTO #myProp_x000d__x000a_FROM csd.prop prop_x000d__x000a_JOIN csd.prop_stts ps on ps.prop_stts_code=prop.prop_stts_code_x000d__x000a_JOIN csd.natr_rqst nr on nr.natr_rqst_code = prop.natr_rqst_code_x000d__x000a_JOIN csd.org  as og on og.org_code=prop.org_code_x000d__x000a_WHERE (((1=1)AND prop.nsf_rcvd_date &gt;= {ts '2016-10-01 00:00:00'}_x000d__x000a__x000d__x000a__x000d__x000a_ AND ps.prop_stts_abbr = 'AWD'_x000d__x000a__x000d__x000a__x000d__x000a_ AND prop.prop_titl_txt LIKE '%BSF%'_x000d__x000a__x000d__x000a_) ) _x000d__x000a_ORDER BY lead_id,ILN_x000d__x000a_SELECT panl_prop.prop_id, panl_prop.panl_id, panl.panl_bgn_date, a.rcom_seq_num, b.rcom_abbr, a.prop_ordr_x000d__x000a_INTO #myPanl_x000d__x000a_FROM #myProp prop, csd.panl_prop panl_prop, csd.panl panl, flflpdb.flp.panl_prop_summ a, flflpdb.flp.panl_rcom_def b_x000d__x000a_WHERE  prop.prop_id=panl_prop.prop_id AND panl_prop.panl_id = panl.panl_id_x000d__x000a_AND  panl_prop.panl_id *= a.panl_id AND prop.prop_id *= a.prop_id AND a.panl_id *= b.panl_id  AND  a.rcom_seq_num *= b.rcom_seq_num_x000d__x000a_SELECT getdate() as run_date,mp.*, prop.pgm_annc_id, prop.org_code, prop.pgm_ele_code, prop.pm_ibm_logn_id, prop_stts.prop_stts_abbr, prop.prop_stts_code, prop_stts.prop_stts_txt, pi.pi_last_name, pi.pi_frst_name, pi.pi_gend_code, inst.inst_shrt_name AS inst_name, inst.st_code, prop.prop_titl_txt, natr_rqst.natr_rqst_txt, natr_rqst.natr_rqst_abbr, prop.bas_rsch_pct, prop.cntx_stmt_id,_x000d__x000a_first.panl_id as 'first_panl', first.panl_bgn_date as 'fp_begin', first.rcom_seq_num as 'fp_recno', first.rcom_abbr as 'fp_rec', first.prop_ordr as 'fp_rank', last.panl_id as 'last_panl', last.panl_bgn_date as 'lp_begin', last.rcom_seq_num as 'lp_recno', last.rcom_abbr as 'lp_rec', last.prop_ordr as 'lp_rank',_x000d__x000a_bs.split_tot_dol, bs.split_frwd_date, bs.split_aprv_date,_x000d__x000a_prop.rqst_dol, prop.rqst_mnth_cnt, nullif(prop.rcom_mnth_cnt,0) AS 'rcom_mnth_cnt', prop.rqst_eff_date, nullif(prop.rcom_eff_date,'1900-01-01') AS 'rcom_eff_date', nullif(prop.pm_asgn_date,'1900-01-01') AS pm_asgn_date, nullif(prop.pm_rcom_date,'1900-01-01') AS  pm_rcom_date, nullif(prop.dd_rcom_date,'1900-01-01') AS  dd_rcom_date,_x000d__x000a_awd.awd_id, awd.tot_intn_awd_amt, pi2.pi_last_name, pi2.pi_frst_name, inst2.inst_shrt_name AS inst_awd, awd.awd_titl_txt, awd.pm_ibm_logn_id, awd.org_code, awd.pgm_ele_code, awd.pgm_div_code, awd.awd_istr_code, awd.awd_stts_code, awd.fpr_stts_code, awd.awd_stts_date, awd.awd_eff_date, awd.awd_exp_date, awd.awd_fin_clos_date, awd.fpr_stts_updt_date, awd.est_fnl_exp_date_x000d__x000a_FROM  #myProp mp, csd.prop prop, csd.inst inst, csd.natr_rqst natr_rqst, csd.pi pi, csd.prop_stts prop_stts,  csd.awd awd, csd.inst inst2, csd.pi pi2,_x000d__x000a_(SELECT *  FROM #myPanl pn_x000d__x000a_WHERE  pn.panl_bgn_date =(SELECT min(p.panl_bgn_date) FROM #myPanl p  WHERE pn.prop_id=p.prop_id ) ) first,_x000d__x000a_(SELECT *  FROM #myPanl pn_x000d__x000a_WHERE  pn.panl_bgn_date &gt;(SELECT min(p.panl_bgn_date) FROM #myPanl p WHERE pn.prop_id=p.prop_id )_x000d__x000a_AND pn.panl_bgn_date = (SELECT max(p.panl_bgn_date) FROM #myPanl p  WHERE pn.prop_id=p.prop_id ) ) last,_x000d__x000a_(SELECT budg_splt.prop_id, Sum(budg_splt.budg_splt_tot_dol) AS 'split_tot_dol', Max(budg_splt.frwd_date) AS 'split_frwd_date', Max(budg_splt.aprv_date) AS 'split_aprv_date'_x000d__x000a_FROM csd.budg_splt budg_splt GROUP BY budg_splt.prop_id) bs_x000d__x000a_WHERE mp.prop_id = prop.prop_id AND prop.natr_rqst_code = natr_rqst.natr_rqst_code AND prop.prop_stts_code = prop_stts.prop_stts_code AND prop.inst_id = inst.inst_id AND prop.pi_id = pi.pi_id AND_x000d__x000a_mp.prop_id *= first.prop_id AND mp.prop_id *= last.prop_id AND mp.prop_id *= bs.prop_id AND mp.prop_id *= awd.awd_id AND awd.inst_id *= inst2.inst_id AND awd.pi_id *= pi2.pi_id_x000d__x000a_ORDER BY mp.lead_id, mp.ILN, mp.prop_id_x000d__x000a_drop table #myProp drop table #myPanl_x000d__x000a_"/></connection><connection id="2" name="SplitQuery" type="1" refreshedVersion="6" saveData="1"><dbPr connection="dsn=RPTSERVER;database=rptdb;server=RPTSQL.nsf.gov;port=5000;UID=ccfuser;" command="SET NOCOUNT ON CREATE TABLE #AddBudgSplts(_x000d__x000a_prop_id char(7),_x000d__x000a_budg_yr smallint null,_x000d__x000a_splt_id char(2) null_x000d__x000a_) _x000d__x000a_CREATE TABLE #OmitBudgSplts(_x000d__x000a_prop_id char(7),_x000d__x000a_budg_yr smallint null,_x000d__x000a_splt_id char(2) null_x000d__x000a_) _x000d__x000a_SELECT b.prop_id,b.budg_yr,b.splt_id,b.budg_splt_tot_dol, b.org_code as Bdg_Org_Code,_x000d__x000a_b.pgm_ele_code+' - '+pe.pgm_ele_name as PEC_bdg_splt_x000d__x000a_INTO #myBSplit_x000d__x000a_from csd.budg_splt b_x000d__x000a_JOIN csd.prop p on p.prop_id=b.prop_id_x000d__x000a_JOIN csd.pgm_ele  as pe ON pe.pgm_ele_code=b.pgm_ele_code_x000d__x000a_JOIN csd.prop_stts ps on ps.prop_stts_code=p.prop_stts_code_x000d__x000a_JOIN csd.natr_rqst nr on nr.natr_rqst_code = p.natr_rqst_code_x000d__x000a_JOIN csd.awd_istr ai on p.rcom_awd_istr = ai.awd_istr_code_x000d__x000a_JOIN csd.org  as og on og.org_code=p.org_code_x000d__x000a_WHERE (((1=1) AND b.budg_yr = 2017_x000d__x000a__x000d__x000a__x000d__x000a__x000d__x000a_ AND b.pgm_ele_code ='5761'_x000d__x000a_ AND ps.prop_stts_abbr NOT IN ('WTH','DECL')_x000d__x000a__x000d__x000a__x000d__x000a__x000d__x000a__x000d__x000a__x000d__x000a__x000d__x000a__x000d__x000a_))_x000d__x000a_INSERT INTO #myBSplit _x000d__x000a_select  bs.prop_id,_x000d__x000a_bs.budg_yr, bs.splt_id,_x000d__x000a_bs.budg_splt_tot_dol, bs.org_code as Bdg_Org_Code,bs.pgm_ele_code+' - '+pe.pgm_ele_name as PEC_bdg_splt_x000d__x000a_from #AddBudgSplts t_x000d__x000a_JOIN CSD.budg_splt bs ON bs.prop_id=t.prop_id  _x000d__x000a_and isnull(t.budg_yr,bs.budg_yr) = bs.budg_yr _x000d__x000a_and isnull(t.splt_id,bs.splt_id) = bs.splt_id _x000d__x000a_JOIN csd.pgm_ele  as pe ON pe.pgm_ele_code=bs.pgm_ele_code_x000d__x000a_delete  from #myBSplit_x000d__x000a_from  #myBSplit b_x000d__x000a_Join  #OmitBudgSplts as t_x000d__x000a_ON b.prop_id=t.prop_id _x000d__x000a_and isnull(t.budg_yr,b.budg_yr) = b.budg_yr _x000d__x000a_and isnull(t.splt_id,b.splt_id) = b.splt_id _x000d__x000a_SELECT bpr.prop_id,bpr.budg_yr,bpr.splt_id, bpr.pgm_ref_code,id=identity(18), 0 as 'seq'_x000d__x000a_INTO #myBudgPRCs FROM #myBSplit mbs,csd.budg_pgm_ref  bpr_x000d__x000a_WHERE mbs.prop_id = bpr.prop_id  AND mbs.splt_id= bpr.splt_id AND mbs.budg_yr=bpr.budg_yr_x000d__x000a_order by bpr.prop_id,bpr.budg_yr,bpr.splt_id, bpr.pgm_ref_code_x000d__x000a_SELECT prop_id,budg_yr,splt_id, MIN(id) as 'start'_x000d__x000a_INTO #mySt2 _x000d__x000a_FROM #myBudgPRCS _x000d__x000a_GROUP BY prop_id,budg_yr,splt_id_x000d__x000a_UPDATE #myBudgPRCs set seq = id-M.start FROM #myBudgPRCs rb, #mySt2 M_x000d__x000a_WHERE rb.prop_id = M.prop_id AND rb.budg_yr=M.budg_yr AND rb.splt_id= M.splt_id _x000d__x000a_SELECT p.prop_id, pa.prop_atr_code,id=identity(18), 0 as 'seq'_x000d__x000a_INTO #myPropPRCs_x000d__x000a_FROM (select distinct prop_id from #myBSplit mbs) as p, csd.prop_atr pa_x000d__x000a_WHERE pa.prop_id = p.prop_id  AND pa.prop_atr_type_code = 'PRC'_x000d__x000a_order by p.prop_id, pa.prop_atr_code_x000d__x000a_SELECT prop_id, MIN(id) as 'start'_x000d__x000a_INTO #mySt3 _x000d__x000a_FROM #myPropPRCs group by prop_id_x000d__x000a_UPDATE #myPropPRCs set seq = id-M.start FROM #myPropPRCs r, #mySt3 M_x000d__x000a_WHERE r.prop_id = M.prop_id _x000d__x000a_select p.prop_id,isnull(p.lead_prop_id,p.prop_id) AS lead_id,_x000d__x000a_CASE WHEN p.lead_prop_id IS NULL THEN 'I' WHEN p.lead_prop_id = p.prop_id THEN 'L' ELSE 'N' END AS ILN,_x000d__x000a_p.nsf_rcvd_date, p.dd_rcom_date, p.pgm_annc_id,p.org_code as Prop_Org_Code,_x000d__x000a_p.pgm_ele_code+' - '+pe.pgm_ele_name as PEC_prop,_x000d__x000a_p.pm_ibm_logn_id as Prop_Pm_ibm_logn_id,_x000d__x000a_p.obj_clas_code as Prop_Obj_Clas_Code,_x000d__x000a_ps.prop_stts_abbr,nr.natr_rqst_abbr,_x000d__x000a_pi.pi_last_name, pi.pi_frst_name,_x000d__x000a_i.inst_shrt_name as inst_name,p.rqst_dol,p.rcom_awd_istr,ai.awd_istr_txt, ai.awd_istr_abbr,ai.awd_istr_abbr as rcom_istr_abbr,_x000d__x000a_p.prop_titl_txt,og.dir_div_abbr,id=identity(18), 0 as 'seq'_x000d__x000a_into #myProp_x000d__x000a_FROM (select distinct prop_id from #myBSplit mbs) as prop_x000d__x000a_JOIN csd.prop p ON p.prop_id = prop.prop_id_x000d__x000a_JOIN  #myBSplit mbs on mbs.prop_id=p.prop_id_x000d__x000a_JOIN csd.awd_istr ai on p.rcom_awd_istr = ai.awd_istr_code_x000d__x000a_JOIN csd.pgm_ele  as pe ON pe.pgm_ele_code=p.pgm_ele_code_x000d__x000a_JOIN csd.prop_stts ps on ps.prop_stts_code=p.prop_stts_code_x000d__x000a_JOIN csd.natr_rqst nr on nr.natr_rqst_code = p.natr_rqst_code_x000d__x000a_JOIN csd.pi_vw pi on p.pi_id=pi.pi_id_x000d__x000a_JOIN csd.inst as i on i.inst_id=p.inst_id_x000d__x000a_JOIN csd.org as og on og.org_code=p.org_code_x000d__x000a_SELECT distinct getdate() as run_date,mp.nsf_rcvd_date,mp.dd_rcom_date,mp.Prop_Org_Code,_x000d__x000a_b.org_code as Budg_Org_Code,mp.PEC_prop,mbs.PEC_bdg_splt,_x000d__x000a_mp.Prop_Pm_ibm_logn_id,b.pm_ibm_logn_id as Budg_Pm_ibm_logn_id, mp.Prop_Obj_Clas_Code,b.obj_clas_code as Budg_Obj_Clas_Code,_x000d__x000a_mp.pgm_annc_id,mp.prop_stts_abbr,mp.natr_rqst_abbr,_x000d__x000a_ mp.dir_div_abbr,mbs.prop_id, mp.ILN,mp.lead_id,b.awd_id, mp.prop_titl_txt,_x000d__x000a_mbs.splt_id,mbs.budg_yr,b.budg_splt_tot_dol,mp.rqst_dol,_x000d__x000a_(SELECT MAX( CASE pa.seq WHEN 0 THEN rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 1 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 2 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 3 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 4 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 5 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 6 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 7 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 8 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 9 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 10 THEN ' '+rtrim(pa.prop_atr_code) END)_x000d__x000a_FROM #myPropPRCs pa WHERE pa.prop_id = mbs.prop_id) AS 'Prop PRCs',_x000d__x000a_(SELECT MAX( CASE bp.seq WHEN 0 THEN rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 1 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 2 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 3 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 4 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 5 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 6 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 7 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 8 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 9 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 10 THEN ' ' + rtrim(bp.pgm_ref_code) END)_x000d__x000a_FROM #myBudgPRCs bp_x000d__x000a_WHERE bp.prop_id=mbs.prop_id and bp.budg_yr=mbs.budg_yr and bp.splt_id = mbs.splt_id group by bp.prop_id, bp.budg_yr, bp.splt_id) AS 'Budg PRCs',_x000d__x000a_mp.pi_last_name, mp.pi_frst_name,mp.inst_name,b.last_updt_user, b.last_updt_tmsp,ast.awd_stts_abbr, ast.awd_stts_txt_x000d__x000a_, cs.cgi_stts_txt,mp.awd_istr_txt, mp.awd_istr_abbr,mp.rcom_istr_abbr from #myBSplit mbs_x000d__x000a_JOIN csd.budg_splt b on mbs.prop_id=b.prop_id and mbs.budg_yr=b.budg_yr and mbs.splt_id=b.splt_id_x000d__x000a_LEFT JOIN csd.awd a on b.awd_id=a.awd_id_x000d__x000a_LEFT JOIN csd.awd_stts ast on a.awd_stts_code=ast.awd_stts_code_x000d__x000a_LEFT JOIN csd.cgi c on  b.awd_id=c.awd_id and b.budg_yr= c.cgi_yr_x000d__x000a_LEFT JOIN csd.cgi_stts cs on c.cgi_stts_code=cs.cgi_stts_code_x000d__x000a_JOIN #myProp mp on mp.prop_id=mbs.prop_id_x000d__x000a_"/></connection><connection id="3" name="SplitQuery1" type="1" refreshedVersion="6" saveData="1"><dbPr connection="dsn=RPTSERVER;database=rptdb;server=RPTSQL.nsf.gov;port=5000;UID=ccfuser;" command="SET NOCOUNT ON CREATE TABLE #AddBudgSplts(_x000d__x000a_prop_id char(7),_x000d__x000a_budg_yr smallint null,_x000d__x000a_splt_id char(2) null_x000d__x000a_) _x000d__x000a_CREATE TABLE #OmitBudgSplts(_x000d__x000a_prop_id char(7),_x000d__x000a_budg_yr smallint null,_x000d__x000a_splt_id char(2) null_x000d__x000a_) _x000d__x000a_SELECT b.prop_id,b.budg_yr,b.splt_id,b.budg_splt_tot_dol, b.org_code as Bdg_Org_Code,_x000d__x000a_b.pgm_ele_code+' - '+pe.pgm_ele_name as PEC_bdg_splt_x000d__x000a_INTO #myBSplit_x000d__x000a_from csd.budg_splt b_x000d__x000a_JOIN csd.prop p on p.prop_id=b.prop_id_x000d__x000a_JOIN csd.pgm_ele  as pe ON pe.pgm_ele_code=b.pgm_ele_code_x000d__x000a_JOIN csd.prop_stts ps on ps.prop_stts_code=p.prop_stts_code_x000d__x000a_JOIN csd.natr_rqst nr on nr.natr_rqst_code = p.natr_rqst_code_x000d__x000a_JOIN csd.awd_istr ai on p.rcom_awd_istr = ai.awd_istr_code_x000d__x000a_JOIN csd.org  as og on og.org_code=p.org_code_x000d__x000a_WHERE (((1=1)AND p.nsf_rcvd_date &gt;= {ts '2012-10-01 00:00:00'}_x000d__x000a__x000d__x000a__x000d__x000a_ AND b.pgm_ele_code ='7797'_x000d__x000a_ AND ps.prop_stts_abbr NOT IN ('DECL','WTH')_x000d__x000a__x000d__x000a__x000d__x000a__x000d__x000a__x000d__x000a__x000d__x000a__x000d__x000a__x000d__x000a_))_x000d__x000a_INSERT INTO #myBSplit _x000d__x000a_select  bs.prop_id,_x000d__x000a_bs.budg_yr, bs.splt_id,_x000d__x000a_bs.budg_splt_tot_dol, bs.org_code as Bdg_Org_Code,bs.pgm_ele_code+' - '+pe.pgm_ele_name as PEC_bdg_splt_x000d__x000a_from #AddBudgSplts t_x000d__x000a_JOIN CSD.budg_splt bs ON bs.prop_id=t.prop_id  _x000d__x000a_and isnull(t.budg_yr,bs.budg_yr) = bs.budg_yr _x000d__x000a_and isnull(t.splt_id,bs.splt_id) = bs.splt_id _x000d__x000a_JOIN csd.pgm_ele  as pe ON pe.pgm_ele_code=bs.pgm_ele_code_x000d__x000a_delete  from #myBSplit_x000d__x000a_from  #myBSplit b_x000d__x000a_Join  #OmitBudgSplts as t_x000d__x000a_ON b.prop_id=t.prop_id _x000d__x000a_and isnull(t.budg_yr,b.budg_yr) = b.budg_yr _x000d__x000a_and isnull(t.splt_id,b.splt_id) = b.splt_id _x000d__x000a_SELECT bpr.prop_id,bpr.budg_yr,bpr.splt_id, bpr.pgm_ref_code,id=identity(18), 0 as 'seq'_x000d__x000a_INTO #myBudgPRCs FROM #myBSplit mbs,csd.budg_pgm_ref  bpr_x000d__x000a_WHERE mbs.prop_id = bpr.prop_id  AND mbs.splt_id= bpr.splt_id AND mbs.budg_yr=bpr.budg_yr_x000d__x000a_order by bpr.prop_id,bpr.budg_yr,bpr.splt_id, bpr.pgm_ref_code_x000d__x000a_SELECT prop_id,budg_yr,splt_id, MIN(id) as 'start'_x000d__x000a_INTO #mySt2 _x000d__x000a_FROM #myBudgPRCS _x000d__x000a_GROUP BY prop_id,budg_yr,splt_id_x000d__x000a_UPDATE #myBudgPRCs set seq = id-M.start FROM #myBudgPRCs rb, #mySt2 M_x000d__x000a_WHERE rb.prop_id = M.prop_id AND rb.budg_yr=M.budg_yr AND rb.splt_id= M.splt_id _x000d__x000a_SELECT p.prop_id, pa.prop_atr_code,id=identity(18), 0 as 'seq'_x000d__x000a_INTO #myPropPRCs_x000d__x000a_FROM (select distinct prop_id from #myBSplit mbs) as p, csd.prop_atr pa_x000d__x000a_WHERE pa.prop_id = p.prop_id  AND pa.prop_atr_type_code = 'PRC'_x000d__x000a_order by p.prop_id, pa.prop_atr_code_x000d__x000a_SELECT prop_id, MIN(id) as 'start'_x000d__x000a_INTO #mySt3 _x000d__x000a_FROM #myPropPRCs group by prop_id_x000d__x000a_UPDATE #myPropPRCs set seq = id-M.start FROM #myPropPRCs r, #mySt3 M_x000d__x000a_WHERE r.prop_id = M.prop_id _x000d__x000a_select p.prop_id,isnull(p.lead_prop_id,p.prop_id) AS lead_id,_x000d__x000a_CASE WHEN p.lead_prop_id IS NULL THEN 'I' WHEN p.lead_prop_id = p.prop_id THEN 'L' ELSE 'N' END AS ILN,_x000d__x000a_p.nsf_rcvd_date, p.dd_rcom_date, p.pgm_annc_id,p.org_code as Prop_Org_Code,_x000d__x000a_p.pgm_ele_code+' - '+pe.pgm_ele_name as PEC_prop,_x000d__x000a_p.pm_ibm_logn_id as Prop_Pm_ibm_logn_id,_x000d__x000a_p.obj_clas_code as Prop_Obj_Clas_Code,_x000d__x000a_ps.prop_stts_abbr,nr.natr_rqst_abbr,_x000d__x000a_pi.pi_last_name, pi.pi_frst_name,_x000d__x000a_i.inst_shrt_name as inst_name,p.rqst_dol,p.rcom_awd_istr,ai.awd_istr_txt, ai.awd_istr_abbr,ai.awd_istr_abbr as rcom_istr_abbr,_x000d__x000a_p.prop_titl_txt,og.dir_div_abbr,id=identity(18), 0 as 'seq'_x000d__x000a_into #myProp_x000d__x000a_FROM (select distinct prop_id from #myBSplit mbs) as prop_x000d__x000a_JOIN csd.prop p ON p.prop_id = prop.prop_id_x000d__x000a_JOIN  #myBSplit mbs on mbs.prop_id=p.prop_id_x000d__x000a_JOIN csd.awd_istr ai on p.rcom_awd_istr = ai.awd_istr_code_x000d__x000a_JOIN csd.pgm_ele  as pe ON pe.pgm_ele_code=p.pgm_ele_code_x000d__x000a_JOIN csd.prop_stts ps on ps.prop_stts_code=p.prop_stts_code_x000d__x000a_JOIN csd.natr_rqst nr on nr.natr_rqst_code = p.natr_rqst_code_x000d__x000a_JOIN csd.pi_vw pi on p.pi_id=pi.pi_id_x000d__x000a_JOIN csd.inst as i on i.inst_id=p.inst_id_x000d__x000a_JOIN csd.org as og on og.org_code=p.org_code_x000d__x000a_SELECT distinct getdate() as run_date,mp.nsf_rcvd_date,mp.dd_rcom_date,mp.Prop_Org_Code,_x000d__x000a_b.org_code as Budg_Org_Code,mp.PEC_prop,mbs.PEC_bdg_splt,_x000d__x000a_mp.Prop_Pm_ibm_logn_id,b.pm_ibm_logn_id as Budg_Pm_ibm_logn_id, mp.Prop_Obj_Clas_Code,b.obj_clas_code as Budg_Obj_Clas_Code,_x000d__x000a_mp.pgm_annc_id,mp.prop_stts_abbr,mp.natr_rqst_abbr,_x000d__x000a_ mp.dir_div_abbr,mbs.prop_id, mp.ILN,mp.lead_id,b.awd_id, mp.prop_titl_txt,_x000d__x000a_mbs.splt_id,mbs.budg_yr,b.budg_splt_tot_dol,mp.rqst_dol,_x000d__x000a_(SELECT MAX( CASE pa.seq WHEN 0 THEN rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 1 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 2 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 3 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 4 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 5 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 6 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 7 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 8 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 9 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 10 THEN ' '+rtrim(pa.prop_atr_code) END)_x000d__x000a_FROM #myPropPRCs pa WHERE pa.prop_id = mbs.prop_id) AS 'Prop PRCs',_x000d__x000a_(SELECT MAX( CASE bp.seq WHEN 0 THEN rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 1 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 2 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 3 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 4 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 5 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 6 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 7 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 8 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 9 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 10 THEN ' ' + rtrim(bp.pgm_ref_code) END)_x000d__x000a_FROM #myBudgPRCs bp_x000d__x000a_WHERE bp.prop_id=mbs.prop_id and bp.budg_yr=mbs.budg_yr and bp.splt_id = mbs.splt_id group by bp.prop_id, bp.budg_yr, bp.splt_id) AS 'Budg PRCs',_x000d__x000a_mp.pi_last_name, mp.pi_frst_name,mp.inst_name,b.last_updt_user, b.last_updt_tmsp,ast.awd_stts_abbr, ast.awd_stts_txt_x000d__x000a_, cs.cgi_stts_txt,mp.awd_istr_txt, mp.awd_istr_abbr,mp.rcom_istr_abbr from #myBSplit mbs_x000d__x000a_JOIN csd.budg_splt b on mbs.prop_id=b.prop_id and mbs.budg_yr=b.budg_yr and mbs.splt_id=b.splt_id_x000d__x000a_LEFT JOIN csd.awd a on b.awd_id=a.awd_id_x000d__x000a_LEFT JOIN csd.awd_stts ast on a.awd_stts_code=ast.awd_stts_code_x000d__x000a_LEFT JOIN csd.cgi c on  b.awd_id=c.awd_id and b.budg_yr= c.cgi_yr_x000d__x000a_LEFT JOIN csd.cgi_stts cs on c.cgi_stts_code=cs.cgi_stts_code_x000d__x000a_JOIN #myProp mp on mp.prop_id=mbs.prop_id_x000d__x000a_"/></connection><connection id="4" name="SplitQuery2" type="1" refreshedVersion="6" saveData="1"><dbPr connection="dsn=RPTSERVER;database=rptdb;server=RPTSQL.nsf.gov;port=5000;UID=ccfuser;" command="SET NOCOUNT ON CREATE TABLE #AddBudgSplts(_x000d__x000a_prop_id char(7),_x000d__x000a_budg_yr smallint null,_x000d__x000a_splt_id char(2) null_x000d__x000a_) _x000d__x000a_CREATE TABLE #OmitBudgSplts(_x000d__x000a_prop_id char(7),_x000d__x000a_budg_yr smallint null,_x000d__x000a_splt_id char(2) null_x000d__x000a_) _x000d__x000a_ Insert into #OmitBudgSplts(prop_id ,budg_yr,splt_id) _x000d__x000a_VALUES('1650483',2018,'01') _x000d__x000a_SELECT b.prop_id,b.budg_yr,b.splt_id,b.budg_splt_tot_dol, b.org_code as Bdg_Org_Code,_x000d__x000a_b.pgm_ele_code+' - '+pe.pgm_ele_name as PEC_bdg_splt_x000d__x000a_INTO #myBSplit_x000d__x000a_from csd.budg_splt b_x000d__x000a_JOIN csd.prop p on p.prop_id=b.prop_id_x000d__x000a_JOIN csd.pgm_ele  as pe ON pe.pgm_ele_code=b.pgm_ele_code_x000d__x000a_JOIN csd.prop_stts ps on ps.prop_stts_code=p.prop_stts_code_x000d__x000a_JOIN csd.natr_rqst nr on nr.natr_rqst_code = p.natr_rqst_code_x000d__x000a_JOIN csd.awd_istr ai on p.rcom_awd_istr = ai.awd_istr_code_x000d__x000a_JOIN csd.org  as og on og.org_code=p.org_code_x000d__x000a_WHERE (((1=1) AND b.budg_yr = 2018_x000d__x000a__x000d__x000a__x000d__x000a__x000d__x000a_ AND b.pgm_ele_code ='5761'_x000d__x000a_ AND ps.prop_stts_abbr NOT IN ('WTH','DECL')_x000d__x000a__x000d__x000a__x000d__x000a_ AND b.pm_ibm_logn_id ='dperkin'_x000d__x000a__x000d__x000a__x000d__x000a__x000d__x000a__x000d__x000a_))_x000d__x000a_INSERT INTO #myBSplit _x000d__x000a_select  bs.prop_id,_x000d__x000a_bs.budg_yr, bs.splt_id,_x000d__x000a_bs.budg_splt_tot_dol, bs.org_code as Bdg_Org_Code,bs.pgm_ele_code+' - '+pe.pgm_ele_name as PEC_bdg_splt_x000d__x000a_from #AddBudgSplts t_x000d__x000a_JOIN CSD.budg_splt bs ON bs.prop_id=t.prop_id  _x000d__x000a_and isnull(t.budg_yr,bs.budg_yr) = bs.budg_yr _x000d__x000a_and isnull(t.splt_id,bs.splt_id) = bs.splt_id _x000d__x000a_JOIN csd.pgm_ele  as pe ON pe.pgm_ele_code=bs.pgm_ele_code_x000d__x000a_delete  from #myBSplit_x000d__x000a_from  #myBSplit b_x000d__x000a_Join  #OmitBudgSplts as t_x000d__x000a_ON b.prop_id=t.prop_id _x000d__x000a_and isnull(t.budg_yr,b.budg_yr) = b.budg_yr _x000d__x000a_and isnull(t.splt_id,b.splt_id) = b.splt_id _x000d__x000a_SELECT bpr.prop_id,bpr.budg_yr,bpr.splt_id, bpr.pgm_ref_code,id=identity(18), 0 as 'seq'_x000d__x000a_INTO #myBudgPRCs FROM #myBSplit mbs,csd.budg_pgm_ref  bpr_x000d__x000a_WHERE mbs.prop_id = bpr.prop_id  AND mbs.splt_id= bpr.splt_id AND mbs.budg_yr=bpr.budg_yr_x000d__x000a_order by bpr.prop_id,bpr.budg_yr,bpr.splt_id, bpr.pgm_ref_code_x000d__x000a_SELECT prop_id,budg_yr,splt_id, MIN(id) as 'start'_x000d__x000a_INTO #mySt2 _x000d__x000a_FROM #myBudgPRCS _x000d__x000a_GROUP BY prop_id,budg_yr,splt_id_x000d__x000a_UPDATE #myBudgPRCs set seq = id-M.start FROM #myBudgPRCs rb, #mySt2 M_x000d__x000a_WHERE rb.prop_id = M.prop_id AND rb.budg_yr=M.budg_yr AND rb.splt_id= M.splt_id _x000d__x000a_SELECT p.prop_id, pa.prop_atr_code,id=identity(18), 0 as 'seq'_x000d__x000a_INTO #myPropPRCs_x000d__x000a_FROM (select distinct prop_id from #myBSplit mbs) as p, csd.prop_atr pa_x000d__x000a_WHERE pa.prop_id = p.prop_id  AND pa.prop_atr_type_code = 'PRC'_x000d__x000a_order by p.prop_id, pa.prop_atr_code_x000d__x000a_SELECT prop_id, MIN(id) as 'start'_x000d__x000a_INTO #mySt3 _x000d__x000a_FROM #myPropPRCs group by prop_id_x000d__x000a_UPDATE #myPropPRCs set seq = id-M.start FROM #myPropPRCs r, #mySt3 M_x000d__x000a_WHERE r.prop_id = M.prop_id _x000d__x000a_select p.prop_id,isnull(p.lead_prop_id,p.prop_id) AS lead_id,_x000d__x000a_CASE WHEN p.lead_prop_id IS NULL THEN 'I' WHEN p.lead_prop_id = p.prop_id THEN 'L' ELSE 'N' END AS ILN,_x000d__x000a_p.nsf_rcvd_date, p.dd_rcom_date, p.pgm_annc_id,p.org_code as Prop_Org_Code,_x000d__x000a_p.pgm_ele_code+' - '+pe.pgm_ele_name as PEC_prop,_x000d__x000a_p.pm_ibm_logn_id as Prop_Pm_ibm_logn_id,_x000d__x000a_p.obj_clas_code as Prop_Obj_Clas_Code,_x000d__x000a_ps.prop_stts_abbr,nr.natr_rqst_abbr,_x000d__x000a_pi.pi_last_name, pi.pi_frst_name,_x000d__x000a_i.inst_shrt_name as inst_name,p.rqst_dol,p.rcom_awd_istr,ai.awd_istr_txt, ai.awd_istr_abbr,ai.awd_istr_abbr as rcom_istr_abbr,_x000d__x000a_p.prop_titl_txt,og.dir_div_abbr,id=identity(18), 0 as 'seq'_x000d__x000a_into #myProp_x000d__x000a_FROM (select distinct prop_id from #myBSplit mbs) as prop_x000d__x000a_JOIN csd.prop p ON p.prop_id = prop.prop_id_x000d__x000a_JOIN  #myBSplit mbs on mbs.prop_id=p.prop_id_x000d__x000a_JOIN csd.awd_istr ai on p.rcom_awd_istr = ai.awd_istr_code_x000d__x000a_JOIN csd.pgm_ele  as pe ON pe.pgm_ele_code=p.pgm_ele_code_x000d__x000a_JOIN csd.prop_stts ps on ps.prop_stts_code=p.prop_stts_code_x000d__x000a_JOIN csd.natr_rqst nr on nr.natr_rqst_code = p.natr_rqst_code_x000d__x000a_JOIN csd.pi_vw pi on p.pi_id=pi.pi_id_x000d__x000a_JOIN csd.inst as i on i.inst_id=p.inst_id_x000d__x000a_JOIN csd.org as og on og.org_code=p.org_code_x000d__x000a_SELECT distinct getdate() as run_date,mp.nsf_rcvd_date,mp.dd_rcom_date,mp.Prop_Org_Code,_x000d__x000a_b.org_code as Budg_Org_Code,mp.PEC_prop,mbs.PEC_bdg_splt,_x000d__x000a_mp.Prop_Pm_ibm_logn_id,b.pm_ibm_logn_id as Budg_Pm_ibm_logn_id, mp.Prop_Obj_Clas_Code,b.obj_clas_code as Budg_Obj_Clas_Code,_x000d__x000a_mp.pgm_annc_id,mp.prop_stts_abbr,mp.natr_rqst_abbr,_x000d__x000a_ mp.dir_div_abbr,mbs.prop_id, mp.ILN,mp.lead_id,b.awd_id, mp.prop_titl_txt,_x000d__x000a_mbs.splt_id,mbs.budg_yr,b.budg_splt_tot_dol,mp.rqst_dol,_x000d__x000a_(SELECT MAX( CASE pa.seq WHEN 0 THEN rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 1 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 2 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 3 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 4 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 5 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 6 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 7 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 8 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 9 THEN ' '+rtrim(pa.prop_atr_code) END)+_x000d__x000a_MAX( CASE pa.seq WHEN 10 THEN ' '+rtrim(pa.prop_atr_code) END)_x000d__x000a_FROM #myPropPRCs pa WHERE pa.prop_id = mbs.prop_id) AS 'Prop PRCs',_x000d__x000a_(SELECT MAX( CASE bp.seq WHEN 0 THEN rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 1 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 2 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 3 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 4 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 5 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 6 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 7 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 8 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 9 THEN ' ' + rtrim(bp.pgm_ref_code) END)+_x000d__x000a_MAX( CASE bp.seq WHEN 10 THEN ' ' + rtrim(bp.pgm_ref_code) END)_x000d__x000a_FROM #myBudgPRCs bp_x000d__x000a_WHERE bp.prop_id=mbs.prop_id and bp.budg_yr=mbs.budg_yr and bp.splt_id = mbs.splt_id group by bp.prop_id, bp.budg_yr, bp.splt_id) AS 'Budg PRCs',_x000d__x000a_mp.pi_last_name, mp.pi_frst_name,mp.inst_name,b.last_updt_user, b.last_updt_tmsp,ast.awd_stts_abbr, ast.awd_stts_txt_x000d__x000a_, cs.cgi_stts_txt,mp.awd_istr_txt, mp.awd_istr_abbr,mp.rcom_istr_abbr from #myBSplit mbs_x000d__x000a_JOIN csd.budg_splt b on mbs.prop_id=b.prop_id and mbs.budg_yr=b.budg_yr and mbs.splt_id=b.splt_id_x000d__x000a_LEFT JOIN csd.awd a on b.awd_id=a.awd_id_x000d__x000a_LEFT JOIN csd.awd_stts ast on a.awd_stts_code=ast.awd_stts_code_x000d__x000a_LEFT JOIN csd.cgi c on  b.awd_id=c.awd_id and b.budg_yr= c.cgi_yr_x000d__x000a_LEFT JOIN csd.cgi_stts cs on c.cgi_stts_code=cs.cgi_stts_code_x000d__x000a_JOIN #myProp mp on mp.prop_id=mbs.prop_id_x000d__x000a_"/></connection></connections>